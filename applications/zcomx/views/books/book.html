{{from applications.zcomx.modules.books import contribute_link, download_link, formatted_name as formatted_book_name, read_link}}
{{from applications.zcomx.modules.creators import can_receive_contributions, formatted_name as formatted_creator_name, torrent_link, url}}
{{from applications.zcomx.modules.images import CreatorImgTag}}
{{from applications.zcomx.modules.utils import ItemDescription}}
{{extend 'layout_main.html'}}
{{creator_name = formatted_creator_name(creator)}}
<div id="book_page">

{{=LOAD(c='z', f='top', args='book', vars={'book_id': book.id, 'creator_id': book.creator_id}, extension='load', ajax=False, content='')}}

<div class="row">
    <div class="col-sm-5" id="left_column">
        <div id="book_cover_img" class="row">
            {{=cover_image}}
        </div>
        <div class="row">
            <div class="col-sm-12 image_footer">
                <ul class="breadcrumb pipe_delimiter">
                    <li>
                    {{=read_link(db, book.id, components=['read'])}}
                    </li>
                    {{if can_receive_contributions(db, creator):}}
                    <li>
                        {{=contribute_link(db, book.id, components=['contribute'], **dict(_class='contribute_button no_rclick_menu'))}}
                    </li>
                    {{pass}}
                    {{dl_link = download_link(db, book.id, components=['download'], **dict(_class='download_button no_rclick_menu'))}}
                    {{if dl_link and str(dl_link) != str(SPAN('')):}}
                    <li>
                        {{=dl_link}}
                    </li>
                    {{pass}}
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-7" id="right_column">
        <div class="row">
            <div id="book_name">
                {{=formatted_book_name(db, book, include_publication_year=(book.release_date != None))}}
            </div>
            {{=ItemDescription(book.description).as_html(**dict(_id='book_description'))}}
            <div id="book_id_section">
                <div id="book_specs_column">
                    <div id="book_links">
                        <dl class="dl-horizontal">
                        <dt>pages</dt><dd>{{=page_count}}</dd>
                        <dt>status</dt><dd>{{='completed' if book.release_date else 'ongoing'}}</dd>
                        <dt>views</dt><dd>{{=book.views}}</dd>
                        <dt>downloads</dt><dd>{{=book.downloads or 0}}</dd>
                        {{if links:}}
                            <dt>buy this book</dt>
                            <dd>{{=links}}</dd>
                        {{pass}}
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <div class="row" id="creator_id_section">
            <div class="col-sm-12" >
                <div class="row">
                    <div class="creator_img_container">
                        <a href="{{=url(creator.id, extension=False)}}" title="{{=creator_name}}">
                        {{=CreatorImgTag(creator.image, size='web', attributes={'_alt': '', '_class': 'img-responsive'})()}}
                        </a>
                    </div>
                    <div class="creator_links_container">
                        <dl class="dl-horizontal">
                        <dt>cartoonist</dt>
                        <dd><a href="{{=url(creator.id, extension=False)}}" title="{{=creator_name}}">{{=creator_name}}</a></dd>
                        {{for f in ['website', 'twitter', 'email']:}}
                            {{try:}}
                            {{if creator[f]:}}
                                <dt>{{=f}}</dt>
                                <dd>{{=db.creator[f].represent(creator[f], creator)}}</dd>
                            {{pass}}
                            {{except:}}
                            {{pass}}
                        {{pass}}
                        {{if creator_links:}}
                            <dt>links</dt>
                            <dd>{{=creator_links}}</dd>
                        {{pass}}
                        {{if creator.torrent:}}
                            <dt>torrent </dt>
                            <dd>{{=torrent_link(creator)}}</dd>
                        {{pass}}
                        </dl>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

</div>
